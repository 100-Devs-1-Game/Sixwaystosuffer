[gd_scene load_steps=20 format=3 uid="uid://catmh6bdnn6fa"]

[ext_resource type="Shader" uid="uid://b85uhaxqgvm8c" path="res://assets/shaders/posterize_canvas.gdshader" id="1_bf3um"]
[ext_resource type="PackedScene" uid="uid://dvbqsel4ymb2x" path="res://revolver/revolver.tscn" id="1_pq8q7"]
[ext_resource type="PackedScene" uid="uid://d2tor451umskh" path="res://player/player.tscn" id="1_vvh5c"]
[ext_resource type="PackedScene" uid="uid://bsrippgh7mwp4" path="res://revolver/patron.tscn" id="3_vvh5c"]
[ext_resource type="Script" uid="uid://beatoaa760esh" path="res://interactions/raise_on_hover.gd" id="5_gd4vy"]
[ext_resource type="PackedScene" uid="uid://c76i00ukwlksk" path="res://assets/furniture/table_01/table_01.tscn" id="5_l8v81"]
[ext_resource type="Script" uid="uid://d0dwks7c5xd3d" path="res://interactions/clicked_on_area.gd" id="5_qw60f"]
[ext_resource type="PackedScene" uid="uid://bvuberatoghu0" path="res://monitors/monitor_3d.tscn" id="5_vyht1"]
[ext_resource type="PackedScene" uid="uid://b2q6630p7t6iy" path="res://table/table_label.tscn" id="6_huihk"]
[ext_resource type="PackedScene" uid="uid://btj7p6v75j8f2" path="res://lamps/lamp.tscn" id="6_vyht1"]
[ext_resource type="PackedScene" uid="uid://b33dr7k4v11mv" path="res://dealer/dealer.tscn" id="8_bf3um"]
[ext_resource type="Script" uid="uid://dfrwjwp73xpko" path="res://common/states/state_machine.gd" id="12_qw60f"]
[ext_resource type="Script" uid="uid://ri6a1tiv3y61" path="res://gameloop/states/select_target_state.gd" id="13_eji0w"]
[ext_resource type="Script" uid="uid://cr7ypn0soa8ln" path="res://gameloop/states/intro_state.gd" id="13_qwhpj"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_bf3um"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_huihk"]
shader = ExtResource("1_bf3um")
shader_parameter/exposure = 1.0
shader_parameter/contrast = 1.1
shader_parameter/saturation = 0.9
shader_parameter/enable_pixelate = false
shader_parameter/pixel_factor = 1.2
shader_parameter/enable_posterize = true
shader_parameter/color_levels = 8.0
shader_parameter/dither_strength = 0.3
shader_parameter/chrom_aberration = 0.01
shader_parameter/vignette_strength = 2.0
shader_parameter/grain_strength = 0.2
shader_parameter/tint_color = Vector3(0.95, 1.03, 0.9)
shader_parameter/tint_strength = 0.15
shader_parameter/viewport_size_override = Vector2(0, 0)

[sub_resource type="Environment" id="Environment_28aoi"]
background_mode = 1
ambient_light_source = 1
ambient_light_energy = 1.67
tonemap_mode = 2
adjustment_enabled = true

[sub_resource type="BoxMesh" id="BoxMesh_jnlp7"]
size = Vector3(1, 1, 1.6)

[sub_resource type="BoxShape3D" id="BoxShape3D_huihk"]
size = Vector3(0.289307, 0.739746, 1.37439)

[node name="Root" type="Node"]

[node name="Player HUD" type="CanvasLayer" parent="."]

[node name="SubViewportContainer" type="SubViewportContainer" parent="."]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer"]
handle_input_locally = false
msaa_3d = 3
screen_space_aa = 1
physics_object_picking = true
size = Vector2i(1152, 648)
render_target_update_mode = 4

[node name="Post Processing" type="PanelContainer" parent="SubViewportContainer/SubViewport"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_styles/panel = SubResource("StyleBoxEmpty_bf3um")

[node name="Posterize Canvas" type="ColorRect" parent="SubViewportContainer/SubViewport/Post Processing"]
material = SubResource("ShaderMaterial_huihk")
layout_mode = 2
mouse_filter = 2

[node name="World3D" type="Node3D" parent="SubViewportContainer/SubViewport"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="SubViewportContainer/SubViewport/World3D"]
environment = SubResource("Environment_28aoi")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="SubViewportContainer/SubViewport/World3D/WorldEnvironment"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 11.9826, 0)
visible = false
shadow_enabled = true

[node name="Play Room" type="Node3D" parent="SubViewportContainer/SubViewport/World3D"]

[node name="Player" parent="SubViewportContainer/SubViewport/World3D/Play Room" instance=ExtResource("1_vvh5c")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.340213, 3.96272, 2.80201)

[node name="PathFollow3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Player/Patron Pickup Trajectory/Patron Load Trajectory" index="0"]
transform = Transform3D(-0.820301, -0.279567, -0.498913, -2.98018e-08, 0.872356, -0.488834, 0.5719, -0.400996, -0.715612, -0.380372, 0.866075, -0.653451)

[node name="Table" type="Node3D" parent="SubViewportContainer/SubViewport/World3D/Play Room"]

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.368759)
visible = false
mesh = SubResource("BoxMesh_jnlp7")

[node name="Revolver Place" type="Marker3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.231696, 3.94544, 0.381624)

[node name="Initial Revolver Position" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place" instance=ExtResource("1_pq8q7")]
transform = Transform3D(-2.18557e-08, 0.5, 0.866026, -1, -4.37114e-08, -3.97734e-14, 3.78552e-08, -0.866026, 0.5, 0, 0, 0)

[node name="Area3D" type="Area3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position/Area3D"]
transform = Transform3D(1, -7.53175e-13, 0, 0, 1, 0, 3.55271e-15, 0, 1, 0.0289307, 0.0617676, -0.460022)
shape = SubResource("BoxShape3D_huihk")

[node name="Raise On Hover" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position" node_paths=PackedStringArray("target", "monitor")]
script = ExtResource("5_gd4vy")
target = NodePath("..")
monitor = NodePath("../Area3D")

[node name="Clicked On Area" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position" node_paths=PackedStringArray("area")]
script = ExtResource("5_qw60f")
area = NodePath("../Area3D")

[node name="Patron" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("3_vvh5c")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.782962, 0.552589, 0.00978923)

[node name="table_01" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("5_l8v81")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.176646, 0)

[node name="Choice Labels" type="Node3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/table_01"]

[node name="Dealer Label" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/table_01/Choice Labels" instance=ExtResource("6_huihk")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 4.0787, -0.638386)
visible = false
text = "DEALER"

[node name="You Label" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/table_01/Choice Labels" instance=ExtResource("6_huihk")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0385482, 4.0787, 1.44612)
visible = false
text = "YOU"

[node name="Monitor 3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("5_vyht1")]
transform = Transform3D(0.902187, 0, 0.431346, 0, 1, 0, -0.431346, 0, 0.902187, -1.7803, 3.87915, -1.2514)
text = "READY?"
is_blinking = true

[node name="Lamp" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("6_vyht1")]

[node name="Dealer" parent="SubViewportContainer/SubViewport/World3D/Play Room" instance=ExtResource("8_bf3um")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -3.68618)

[node name="GameLoop" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room"]

[node name="StateMachine" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop" node_paths=PackedStringArray("initial_state")]
script = ExtResource("12_qw60f")
initial_state = NodePath("IntroState")
metadata/_custom_type_script = "uid://dfrwjwp73xpko"

[node name="IntroState" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine" node_paths=PackedStringArray("initial_revolver_position", "clicked_on_revolver", "player")]
script = ExtResource("13_qwhpj")
initial_revolver_position = NodePath("../../../Table/Revolver Place/Initial Revolver Position")
clicked_on_revolver = NodePath("../../../Table/Revolver Place/Initial Revolver Position/Clicked On Area")
player = NodePath("../../../Player")
metadata/_custom_type_script = "uid://cr7ypn0soa8ln"

[node name="SelectTargetState" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine" node_paths=PackedStringArray("dealer_label", "self_label", "dealer", "player")]
script = ExtResource("13_eji0w")
dealer_label = NodePath("../../../Table/table_01/Choice Labels/Dealer Label")
self_label = NodePath("../../../Table/table_01/Choice Labels/You Label")
dealer = NodePath("../../../Dealer")
player = NodePath("../../../Player")
metadata/_custom_type_script = "uid://ri6a1tiv3y61"

[editable path="SubViewportContainer/SubViewport/World3D/Play Room/Player"]
[editable path="SubViewportContainer/SubViewport/World3D/Play Room/Player/Player Hand/Tremor/Revolver"]
[editable path="SubViewportContainer/SubViewport/World3D/Play Room/Player/Player Hand/Tremor/Revolver/Revolver Hand/revolver"]
