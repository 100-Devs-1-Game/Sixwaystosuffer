[gd_scene load_steps=26 format=3 uid="uid://catmh6bdnn6fa"]

[ext_resource type="PackedScene" uid="uid://dvbqsel4ymb2x" path="res://revolver/revolver.tscn" id="1_pq8q7"]
[ext_resource type="Material" uid="uid://cqrht8riym6nn" path="res://assets/shaders/posterize_canvas.tres" id="1_sq7yr"]
[ext_resource type="PackedScene" uid="uid://d2tor451umskh" path="res://player/player.tscn" id="1_vvh5c"]
[ext_resource type="Environment" uid="uid://blb6sexedwx1w" path="res://environment/world_environment.tres" id="2_r3r3k"]
[ext_resource type="Script" uid="uid://dvh37wnsy4miy" path="res://common/interactions/clickable_area3d.gd" id="5_blcw0"]
[ext_resource type="Script" uid="uid://beatoaa760esh" path="res://common/interactions/raise_on_hover.gd" id="5_gd4vy"]
[ext_resource type="PackedScene" uid="uid://c76i00ukwlksk" path="res://assets/furniture/table_01/table_01.tscn" id="5_l8v81"]
[ext_resource type="PackedScene" uid="uid://btj7p6v75j8f2" path="res://environment/lamps/lamp.tscn" id="6_vyht1"]
[ext_resource type="AudioStream" uid="uid://difed6gqnkh83" path="res://assets/sfx/load_02.ogg" id="7_3dlgs"]
[ext_resource type="PackedScene" uid="uid://b33dr7k4v11mv" path="res://dealer/dealer.tscn" id="8_bf3um"]
[ext_resource type="Script" uid="uid://dgx7u8h426p70" path="res://common/interactions/hover_sound_player.gd" id="8_vte5o"]
[ext_resource type="PackedScene" uid="uid://bipg2ekrwq3vr" path="res://environment/table/choice_labels.tscn" id="9_r3r3k"]
[ext_resource type="PackedScene" uid="uid://ci6kjbj6cbjwm" path="res://environment/monitors/quequed_monitor_3d.tscn" id="11_po8fv"]
[ext_resource type="Script" uid="uid://dfrwjwp73xpko" path="res://common/states/state_machine.gd" id="12_qw60f"]
[ext_resource type="Script" uid="uid://ri6a1tiv3y61" path="res://gameloop/states/gameplay_state.gd" id="13_eji0w"]
[ext_resource type="PackedScene" uid="uid://dac88b174qeox" path="res://player/patrons/patrons.tscn" id="13_po8fv"]
[ext_resource type="Script" uid="uid://cr7ypn0soa8ln" path="res://gameloop/states/intro_state.gd" id="13_qwhpj"]
[ext_resource type="Script" uid="uid://lavn4gocuq3b" path="res://gameloop/states/revolver_loading_state.gd" id="14_qt76e"]
[ext_resource type="Script" uid="uid://cy6wfx5xalpb6" path="res://gameloop/states/game_over_state.gd" id="16_r3r3k"]
[ext_resource type="AudioStream" uid="uid://dbuboxh6nrwe" path="res://assets/sfx/music_main_menu.ogg" id="16_sq7yr"]
[ext_resource type="AudioStream" uid="uid://uuj0ag6xyihm" path="res://assets/sfx/kill_self_headshot.ogg" id="17_blcw0"]
[ext_resource type="Script" uid="uid://cpelv7p3e1pqj" path="res://common/audio/smooth_audio_stream_player.gd" id="21_vte5o"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_bf3um"]

[sub_resource type="BoxShape3D" id="BoxShape3D_huihk"]
size = Vector3(0.289307, 0.739746, 1.37439)

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_po8fv"]
random_pitch = 1.5
random_volume_offset_db = 3.0
streams_count = 1
stream_0/stream = ExtResource("7_3dlgs")

[node name="Root" type="Node"]

[node name="Player HUD" type="CanvasLayer" parent="."]

[node name="SubViewportContainer" type="SubViewportContainer" parent="."]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer"]
handle_input_locally = false
msaa_3d = 3
screen_space_aa = 1
physics_object_picking = true
size = Vector2i(1152, 648)
render_target_update_mode = 4

[node name="Post Processing" type="PanelContainer" parent="SubViewportContainer/SubViewport"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_styles/panel = SubResource("StyleBoxEmpty_bf3um")

[node name="Posterize Canvas" type="ColorRect" parent="SubViewportContainer/SubViewport/Post Processing"]
material = ExtResource("1_sq7yr")
layout_mode = 2
mouse_filter = 2

[node name="World3D" type="Node3D" parent="SubViewportContainer/SubViewport"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="SubViewportContainer/SubViewport/World3D"]
environment = ExtResource("2_r3r3k")

[node name="Play Room" type="Node3D" parent="SubViewportContainer/SubViewport/World3D"]

[node name="Player" parent="SubViewportContainer/SubViewport/World3D/Play Room" node_paths=PackedStringArray("patrons") instance=ExtResource("1_vvh5c")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.340213, 3.96272, 2.80201)
patrons = NodePath("../Table/Patrons")

[node name="Table" parent="SubViewportContainer/SubViewport/World3D/Play Room" instance=ExtResource("5_l8v81")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.176646, 0)

[node name="Choice Labels" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" node_paths=PackedStringArray("monitor") instance=ExtResource("9_r3r3k")]
monitor = NodePath("../Quequed Monitor3D")

[node name="Revolver Place" type="Marker3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.231696, 4.12209, 0.381624)

[node name="Initial Revolver Position" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place" instance=ExtResource("1_pq8q7")]
transform = Transform3D(-2.18557e-08, 0.5, 0.866026, -1, -4.37114e-08, -3.97734e-14, 3.78552e-08, -0.866026, 0.5, 0, 0, 0)

[node name="Initial Revolver Area3d" type="Area3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position"]
monitoring = false
monitorable = false
script = ExtResource("5_blcw0")

[node name="CollisionShape3D" type="CollisionShape3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position/Initial Revolver Area3d"]
transform = Transform3D(1, -7.53175e-13, 0, 0, 1, 0, 3.55271e-15, 0, 1, 0.0289307, 0.0617676, -0.460022)
shape = SubResource("BoxShape3D_huihk")

[node name="Raise On Hover" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position" node_paths=PackedStringArray("target", "monitor")]
script = ExtResource("5_gd4vy")
target = NodePath("..")
monitor = NodePath("../Initial Revolver Area3d")
height = 0.05
duration = 0.25

[node name="HoverSoundPlayer" type="AudioStreamPlayer" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table/Revolver Place/Initial Revolver Position" node_paths=PackedStringArray("area")]
stream = SubResource("AudioStreamRandomizer_po8fv")
volume_db = -6.0
pitch_scale = 1.6
script = ExtResource("8_vte5o")
area = NodePath("../Initial Revolver Area3d")
metadata/_custom_type_script = "uid://dgx7u8h426p70"

[node name="Quequed Monitor3D" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("11_po8fv")]
transform = Transform3D(0.902187, 0, 0.431346, 0, 1, 0, -0.431346, 0, 0.902187, -1.7803, 4.0558, -1.2514)

[node name="Lamp" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("6_vyht1")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.176646, 0)

[node name="Patrons" parent="SubViewportContainer/SubViewport/World3D/Play Room/Table" instance=ExtResource("13_po8fv")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.14708, 4.13482, 0.778834)

[node name="Dealer" parent="SubViewportContainer/SubViewport/World3D/Play Room" instance=ExtResource("8_bf3um")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -3.68618)

[node name="GameLoop" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room"]

[node name="StateMachine" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop" node_paths=PackedStringArray("initial_state")]
script = ExtResource("12_qw60f")
initial_state = NodePath("IntroState")
metadata/_custom_type_script = "uid://dfrwjwp73xpko"

[node name="IntroState" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine" node_paths=PackedStringArray("initial_revolver_position", "initial_revolver_area3d", "dealer", "player", "main_theme_audio", "player_patrons", "monitor_3d")]
script = ExtResource("13_qwhpj")
initial_revolver_position = NodePath("../../../Table/Revolver Place/Initial Revolver Position")
initial_revolver_area3d = NodePath("../../../Table/Revolver Place/Initial Revolver Position/Initial Revolver Area3d")
dealer = NodePath("../../../Dealer")
player = NodePath("../../../Player")
main_theme_audio = NodePath("../../Main Theme Audio Player")
player_patrons = NodePath("../../../Table/Patrons")
monitor_3d = NodePath("../../../Table/Quequed Monitor3D")
metadata/_custom_type_script = "uid://cr7ypn0soa8ln"

[node name="RevolverLoadingState" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine" node_paths=PackedStringArray("player")]
script = ExtResource("14_qt76e")
player = NodePath("../../../Player")
metadata/_custom_type_script = "uid://lavn4gocuq3b"

[node name="GameplayState" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine" node_paths=PackedStringArray("choices", "dealer", "player")]
script = ExtResource("13_eji0w")
choices = NodePath("../../../Table/Choice Labels")
dealer = NodePath("../../../Dealer")
player = NodePath("../../../Player")
metadata/_custom_type_script = "uid://ri6a1tiv3y61"

[node name="GameOverState" type="Node" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine" node_paths=PackedStringArray("curtain", "selfshot_audio", "main_theme_audio")]
script = ExtResource("16_r3r3k")
curtain = NodePath("CanvasLayer/GameOver Curtain")
selfshot_audio = NodePath("Game Over Audio")
main_theme_audio = NodePath("../../Main Theme Audio Player")
metadata/_custom_type_script = "uid://cy6wfx5xalpb6"

[node name="CanvasLayer" type="CanvasLayer" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine/GameOverState"]

[node name="GameOver Curtain" type="ColorRect" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine/GameOverState/CanvasLayer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
color = Color(0, 0, 0, 0)

[node name="Game Over Audio" type="AudioStreamPlayer" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop/StateMachine/GameOverState"]
stream = ExtResource("17_blcw0")

[node name="Main Theme Audio Player" type="AudioStreamPlayer" parent="SubViewportContainer/SubViewport/World3D/Play Room/GameLoop"]
stream = ExtResource("16_sq7yr")
script = ExtResource("21_vte5o")
metadata/_custom_type_script = "uid://cpelv7p3e1pqj"
